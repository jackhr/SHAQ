const STATE={configFP:{enableTime:!0,altInput:!0,altFormat:"F j, Y h:i K",dateFormat:"Y-m-d H:i",minDate:"today"},pickUpFP:null,returnFP:null,emailRegEx:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/};function handleInvalidFormData(e,t){let n;return"itinerary"===t?"Choose Office"!==e.pickUpLocation&&e.pickUpLocation?e.pickUpDate.date?isWithinBusinessHours(e.pickUpDate.date)?e.returnToSameLocation.checked||"Choose Office"!==e.returnLocation&&e.returnLocation?e.returnDate.date?isWithinBusinessHours(e.returnDate.date)?pickUpDateIsSameAsReturnDate(e)?(n="You cannot pick up and return the car on the same day.",element=$("#pick-up-flatpickr + input, #return-flatpickr + input")):pickUpDateIsAfterReturnDate(e)&&(n="You have to return the car at least one day after pick up.",element=$("#pick-up-flatpickr + input, #return-flatpickr + input")):(n="Return time must be between 8am and 6pm.",element=$("#return-flatpickr + input")):(n="Please select a return date.",element=$("#return-flatpickr + input")):(n="Please select a return location.",element=$(".custom-select.return")):(n="Pick up time must be between 8am and 6pm.",element=$("#pick-up-flatpickr + input")):(n="Please select a pick up date.",element=$("#pick-up-flatpickr + input")):(n="Please select a pick up location.",element=$(".custom-select.pick-up")):"final_details"===t?""===e["first-name"]?(n="Please enter your first name.",element=$('#final-details-form input[name="first-name"]')):""===e["last-name"]?(n="Please enter your last name.",element=$('#final-details-form input[name="last-name"]')):""===e["country-region"]?(n="Please enter your country or region.",element=$('#final-details-form input[name="country-region"]')):""===e.street?(n="Please enter your street address.",element=$('#final-details-form input[name="street"]')):""===e["town-city"]?(n="Please enter your town or city.",element=$('#final-details-form input[name="town-city"]')):""===e.phone?(n="Please enter your phone number.",element=$('#final-details-form input[name="phone"]')):""===e.email?(n="Please enter your email address.",element=$('#final-details-form input[name="email"]')):STATE.emailRegEx.test(e.email)||(n="Please enter a valid email address.",element=$('#final-details-form input[name="email"]')):"contact"===t&&(""===e.name?(n="Please enter your name.",element=$('#contact-form-section input[name="name"]')):""===e.email?(n="Please enter your email address.",element=$('#contact-form-section input[name="email"]')):STATE.emailRegEx.test(e.email)?""===e.message&&(n="Please enter your message.",element=$('#contact-form-section textarea[name="message"]')):(n="Please enter a valid email address.",element=$('#contact-form-section input[name="email"]'))),n&&(Swal.fire({text:n,title:"Incomplete form",icon:"warning",confirmButtonText:"Ok"}),element.addClass("form-error")),!n}function isWithinBusinessHours(e){e="string"==typeof e?new Date(e):e;const t=e?.getHours?.();return t>=8&&t<=18}function pickUpDateIsSameAsReturnDate(e){return getDayFromDate(e.pickUpDate.altValue)===getDayFromDate(e.returnDate.altValue)&&e.pickUpDate.ts+864e5>e.returnDate.ts}function pickUpDateIsAfterReturnDate(e){const t=getDayFromDate(e.pickUpDate.altValue),n=getDayFromDate(e.returnDate.altValue);return getYearFromDate(e.pickUpDate.altValue)>getYearFromDate(e.returnDate.altValue)||t>n&&e.pickUpDate.ts-864e5>e.returnDate.ts}function getDayFromDate(e){if(e)return Number(e.split(",")[0].split(" ")[1])}function getYearFromDate(e){if(e)return Number(e.split(", ")[1].split(" ")[0])}function goToAddOns(){$(".booking-flow-section").hide(),$("#vehicle-add-ons").show()}function getDifferenceInDays(e,t){const n=new Date(Number(e)),a=new Date(Number(t)),i=Math.abs(a-n);return Math.ceil(i/864e5)}function makePriceString(e,t=1,n="USD"){return e||(e=0),"USD"!==n&&"EC"!==n&&(n="USD"),`$${n}${parseInt(e)*t}`}function getAddOnCostForTotalDays(e,t=1,n=void 0){let a=Number(e.cost);return"Collision Insurance"===e.name&&(a=n?Number(n.insurance)*t:0),a}function getAddOnsSubTotal(e){let t=0;if(e.add_ons){let n=1;e.vehicle&&e.itinerary&&(n=getDifferenceInDays(e.itinerary.pickUpDate.ts,e.itinerary.returnDate.ts));for(const a in e.add_ons){t+=getAddOnCostForTotalDays(e.add_ons[a],n,e.vehicle)}}return t}$((function(){STATE.pickUpFP=$("#pick-up-flatpickr").flatpickr?.(STATE.configFP),STATE.returnFP=$("#return-flatpickr").flatpickr?.(STATE.configFP),$(".checkbox-container").on("click",(function(){const e=$(this).find("input"),t=e.prop("checked"),n="reservation-page"===$("body").prop("id")?$(".custom-select.return").parent("div"):$(".custom-select.return");e.prop("checked",!t),n.slideToggle(!t)})),$(".custom-select").on("click",(function(){$(".custom-select").removeClass("active"),$(this).addClass("active"),$("html").addClass("viewing-custom-select-options")})),$(".custom-select-options span").on("click",(function(e){e.stopPropagation(),$("html").removeClass("viewing-custom-select-options"),$(this).siblings().removeClass("selected"),$(this).addClass("selected");const t=$(this).text();$(".custom-select.active > span").text(t),$(".custom-select").removeClass("active")})),$("body .overlay").on("click",(function(){$("html").hasClass("viewing-custom-select-options")&&$("html").removeClass("viewing-custom-select-options"),$("html").hasClass("viewing-hamburger-menu")&&$("html").removeClass("viewing-hamburger-menu")})),$("#intro-section form").on("submit",(async function(e){e.preventDefault(),$(".form-input").removeClass("form-error");const t=$("#return-to-same-location").prop("checked"),n=$(".pick-up .custom-select-options span.selected").text(),a=STATE.pickUpFP.selectedDates[0]?.getTime?.(),i=STATE.returnFP.selectedDates[0]?.getTime?.(),r={action:"itinerary",pickUpLocation:n,returnLocation:t?n:$(".return .custom-select-options span.selected").text(),returnToSameLocation:{checked:t,value:t?"on":"off"},pickUpDate:{date:STATE.pickUpFP.selectedDates[0].toISOString(),ts:STATE.pickUpFP.selectedDates[0]?.getTime?.(),value:STATE.pickUpFP.input.value,altValue:STATE.pickUpFP.altInput.value},returnDate:{date:STATE.returnFP.selectedDates[0].toISOString(),ts:STATE.returnFP.selectedDates[0]?.getTime?.(),value:STATE.returnFP.input.value,altValue:STATE.returnFP.altInput.value},step:2,days:getDifferenceInDays(a,i)};handleInvalidFormData(r,"itinerary")&&(location.href=`/reservation/?itinerary[pickUpLocation]=${r.pickUpLocation}&itinerary[returnLocation]=${r.returnLocation}&itinerary[returnToSameLocation][checked]=${t+0}&itinerary[returnToSameLocation][value]=${t?"on":"off"}&itinerary[pickUpDate][date]=${r.pickUpDate.date}&itinerary[pickUpDate][ts]=${r.pickUpDate.ts}&itinerary[pickUpDate][value]=${r.pickUpDate.value}&itinerary[pickUpDate][altValue]=${r.pickUpDate.altValue}&itinerary[returnDate][date]=${r.returnDate.date}&itinerary[returnDate][ts]=${r.returnDate.ts}&itinerary[returnDate][value]=${r.returnDate.value}&itinerary[returnDate][altValue]=${r.returnDate.altValue}&step=2&itinerary[days]=${r.days}`)})),$(".faq").on("click",(function(){$(this).toggleClass("open"),$(this).find(".faq-answer").slideToggle()})),$(".reservation-step").on("click",(async function(){if($(this).hasClass("active"))return;const e=$(this).data("step");$(".reservation-step").removeClass("active"),$(this).addClass("active");const t=()=>{$(".booking-flow-section").hide(),$(`section[data-step="${e}"]`).first().show()};if(2===e){const e=await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"get_reservation"})});if((await e.json()).vehicle)return goToAddOns();t()}else t()})),$(".vehicle-container .continue-btn").on("click",(async function(){const e=$(this).closest(".vehicle-container"),t=e.data("vehicle-id"),n=e.find(".vehicle-name").text(),a=e.children("img").attr("src"),i={action:"vehicle",id:t},r=await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),s=await r.json();await Swal.fire({title:`Choosing ${n} (${s.vehicle.type})...`,timer:1500,didOpen:()=>Swal.showLoading()}),$(".vehicle-container").removeClass("active"),e.addClass("active").find(".continue-btn").text("CONTINUE");const o=`$${s.vehicle.insurance}/day`;$(".reservation-step.vehicle-add-on .body>div:first h6, #reservation-summary>h5").text(n),$(".reservation-step.vehicle-add-on .body>div:first p, #reservation-summary>h6").text(`${s.vehicle.type} - USD${o} Insurance`),$('.add-on-container[data-add-on-name="Collision Insurance"] h2').text(`Collision Insurance - ${o}`),$("#reservation-summary div.car.summary").html(`<img src="${a}" alt="${n}">`);let c=Number(s.vehicle.base_price_USD);s.discount&&(c=Number(s.discount.price_USD));const l={days:s.itinerary?s.itinerary.days:1,rate:makePriceString(c),subtotal:makePriceString(c)};s.itinerary&&(l.subtotal=makePriceString(c,l.days));let d=l.rate;s.discount&&(d+=`<div class="discount-tool-tip">i<div><span>Fixed price:</span><span><b>2</b> days or more: <b>${l.rate}</b></span></div></div>`),$("#reservation-summary div.rate.summary").html(`\n<h6>Rate</h6>\n<table>\n<thead>\n<tr>\n<th>Day(s)</th>\n<th>Rate</th>\n<th>Subtotal</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>${l.days}</td>\n<td>${d}</td>\n<td>${l.subtotal}</td>\n</tr>\n<tr>\n<td colspan="2">Rental Subtotal</td>\n<td>${l.subtotal}</td>\n</tr>\n</tbody>\n</table>\n`);const u=getAddOnsSubTotal(s);if(s.add_ons){let e="",t="",n=0;const a=s?.itinerary?.days;for(const t in s.add_ons){n++;const i=s.add_ons[t];let r=i.cost,o=`1 x ${i.name}`;"1"!==i.fixed_price&&(o+=` for ${a||1} day(s)`),"Collision Insurance"===i.name&&(r=s.vehicle?s.vehicle.insurance:0),e+=`\n<tr data-id="${i.id}">\n<td>${o}</td>\n<td>${makePriceString(r)}</td>\n<td>${makePriceString(getAddOnCostForTotalDays(i,a,s.vehicle))}</td>\n</tr>\n`}t=e.length?`\n<h6>Add-ons</h6>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Rate</th>\n<th>Subtotal</th>\n</tr>\n</thead>\n<tbody>\n${e}\n<tr>\n<td>Add-ons Subtotal</td>\n<td></td>\n<td>${makePriceString(u)}</td>\n</tr>\n</tbody>\n</table>\n`:"\n<h6>Add-ons</h6>\n<div><span>--</span><span>--</span><span>--</span></div>\n",$("#reservation-summary div.add-ons.summary").html(t)}const m=parseInt(c)*l.days;$("#reservation-summary .estimated-total span:last-child").text(makePriceString(u+m)),goToAddOns()})),$(".more-add-on-info").on("click",(function(){const e=$(this).closest(".add-on-container"),t=e.hasClass("viewing-info");e.toggleClass("viewing-info",!t),e.children("p").slideToggle(!t)})),$(".add-on-btn").on("click",(async function(){const e=$(this).closest(".add-on-container"),t={action:$(this).hasClass("added")?"remove_add_on":"add_add_on",id:e.data("id")},n=await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();let i=Number(a.vehicle.base_price_USD);a.discount&&(i=Number(a.discount.price_USD));const r=a.itinerary?a.itinerary.days:1;let s="",o="",c="",l=0;for(const e in a.add_ons){l++;const t=a.add_ons[e];let n=t.cost,i=`1 x ${t.name}`;"1"!==t.fixed_price&&(i+=` for ${r} day(s)`),"Collision Insurance"===t.name&&(n=a.vehicle?a.vehicle.insurance:0),s+=`\n<tr data-id="${t.id}">\n<td>${i}</td>\n<td>${makePriceString(n)}</td>\n<td>${makePriceString(getAddOnCostForTotalDays(t,r,a.vehicle))}</td>\n</tr>\n`,o+=`${l>1?", ":""}<span data-id="${t.id}">${t.abbr}</span>`}const d=getAddOnsSubTotal(a);c=s.length?`\n<h6>Add-ons</h6>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Rate</th>\n<th>Subtotal</th>\n</tr>\n</thead>\n<tbody>\n${s}\n<tr>\n<td>Add-ons Subtotal</td>\n<td></td>\n<td>${makePriceString(d)}</td>\n</tr>\n</tbody>\n</table>\n`:"\n<h6>Add-ons</h6>\n<div><span>--</span><span>--</span><span>--</span></div>\n";const u=parseInt(i)*r;$("#reservation-summary div.add-ons.summary").html(c),$(".reservation-step.vehicle-add-on .body > div:last-child p").html(o||"--"),$("#reservation-summary .estimated-total span:last-child").text(makePriceString(d+u)),$(this).hasClass("added")?($(this).removeClass("added"),$(this).addClass("show-removed"),setTimeout((()=>$(this).removeClass("show-removed")),1e3)):($(this).addClass("added show-added"),setTimeout((()=>$(this).removeClass("show-added")),1e3))})),$(".change-car-btn, .car.summary > div").on("click",(function(){$(".reservation-step").removeClass("active"),$(".reservation-step.vehicle-add-on").addClass("active"),$(".booking-flow-section").hide(),$("#vehicle-selection-section").show()})),$("#vehicle-add-ons .continue-btn:not(.change-car-btn)").on("click",(function(){$(".reservation-step[data-step='3'] .header").click()})),$("#itinerary-section .continue-btn:not(.change-car-btn)").on("click",(async function(){$(".form-input").removeClass("form-error");const e=$("#return-to-same-location").prop("checked"),t=$(".reservation-flow-container .pick-up .custom-select-options span.selected").text(),n={action:"itinerary",pickUpLocation:t,returnLocation:e?t:$(".reservation-flow-container .return .custom-select-options span.selected").text(),returnToSameLocation:{checked:e,value:e?"on":"off"},pickUpDate:{date:STATE.pickUpFP.selectedDates[0],ts:STATE.pickUpFP.selectedDates[0]?.getTime?.(),value:STATE.pickUpFP.input.value,altValue:STATE.pickUpFP.altInput.value},returnDate:{date:STATE.returnFP.selectedDates[0],ts:STATE.returnFP.selectedDates[0]?.getTime?.(),value:STATE.returnFP.input.value,altValue:STATE.returnFP.altInput.value},step:2};if(!handleInvalidFormData(n,"itinerary"))return;const a=await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await a.json();if($(".reservation-step.itinerary .body>div:first-child p").text(`${n.pickUpLocation} - ${n.pickUpDate.altValue}`),$(".reservation-step.itinerary .body>div:last-child p").text(`${n.returnLocation} - ${n.returnDate.altValue}`),await Swal.fire({title:"Setting Itinerary...",timer:1e3,didOpen:()=>Swal.showLoading()}),$(".reservation-step.vehicle-add-on .header").trigger("click"),i.vehicle){let e=Number(i.vehicle.base_price_USD);i.discount&&(e=Number(i.discount.price_USD));const t={days:i.itinerary.days,rate:makePriceString(e),subtotal:makePriceString(e,i.itinerary.days)};let n=t.rate;i.discount&&(n+=`<div class="discount-tool-tip">i<div><span>Fixed price:</span><span><b>2</b> days or more: <b>${t.rate}</b></span></div></div>`),$("#reservation-summary div.rate.summary").html(`\n<h6>Rate</h6>\n<table>\n<thead>\n<tr>\n<th>Day(s)</th>\n<th>Rate</th>\n<th>Subtotal</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>${t.days}</td>\n<td>${n}</td>\n<td>${t.subtotal}</td>\n</tr>\n<tr>\n<td colspan="2">Rental Subtotal</td>\n<td>${t.subtotal}</td>\n</tr>\n</tbody>\n</table>\n`);const a=getAddOnsSubTotal(i);if(i.add_ons){let e="",t="",n=0;for(const t in i.add_ons){n++;const a=i.add_ons[t];let r=a.cost,s=`1 x ${a.name}`;"1"!==a.fixed_price&&(s+=` for ${i.itinerary.days} day(s)`),"Collision Insurance"===a.name&&(r=i.vehicle?i.vehicle.insurance:0),e+=`\n<tr data-id="${a.id}">\n<td>${s}</td>\n<td>${makePriceString(r)}</td>\n<td>${makePriceString(getAddOnCostForTotalDays(a,i.itinerary.days,i.vehicle))}</td>\n</tr>\n`}t=e.length?`\n<h6>Add-ons</h6>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Rate</th>\n<th>Subtotal</th>\n</tr>\n</thead>\n<tbody>\n${e}\n<tr>\n<td>Add-ons Subtotal</td>\n<td></td>\n<td>${makePriceString(a)}</td>\n</tr>\n</tbody>\n</table>\n`:"\n<h6>Add-ons</h6>\n<div><span>--</span><span>--</span><span>--</span></div>\n",$("#reservation-summary div.add-ons.summary").html(t)}const r=parseInt(e)*t.days;$("#reservation-summary .estimated-total span:last-child").text(makePriceString(a+r)),goToAddOns()}})),$(".form-input").on("focus change input click",(function(){$(this).removeClass("form-error")})),$(".reset-data").on("click",(async function(){(await Swal.fire({icon:"warning",title:"Are you sure you want to reset the form?",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"})).isConfirmed&&(await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reset_reservation"})}),location.href="/reservation/")})),$("#hamburger-button").on("click",(function(){$("html").addClass("viewing-hamburger-menu")})),$("#close-hamburger").on("click",(function(){$("html").removeClass("viewing-hamburger-menu")})),$("#final-details-form .continue-btn").on("click",(async function(){const e={hotel:$('#final-details-form input[name="hotel"]').val(),"first-name":$('#final-details-form input[name="first-name"]').val(),"last-name":$('#final-details-form input[name="last-name"]').val(),"driver-license":$('#final-details-form input[name="driver-license"]').val(),"country-region":$('#final-details-form input[name="country-region"]').val(),street:$('#final-details-form input[name="street"]').val(),"town-city":$('#final-details-form input[name="town-city"]').val(),"state-county":$('#final-details-form input[name="state-county"]').val(),phone:$('#final-details-form input[name="phone"]').val(),email:$('#final-details-form input[name="email"]').val(),h826r2whj4fi_cjz8jxs2zuwahhhk6:""};if(!handleInvalidFormData(e,"final_details"))return;const t=await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"get_reservation"})}),n=await t.json();if(!n.itinerary)return Swal.fire({icon:"warning",title:"Incomplete Booking",text:"Please complete the itinerary section of the booking before submitting."}),$(".reservation-step.itinerary").trigger("click");if(!n.vehicle)return Swal.fire({icon:"warning",title:"Incomplete Booking",text:"Please complete the vehicle selection section of the booking before submitting."}),$(".reservation-step.vehicle-add-on").trigger("click");Swal.fire({title:"Sending request...",didOpen:()=>Swal.showLoading()});const a=await fetch("/includes/vehicle-request-send.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i=await a.json();if(i.data.debugging)return console.log(i);i.success&&!i.data.debugging?location.href=`/confirmation/?key=${i.data.key}`:Swal.fire({title:"Error",text:i.message,icon:"error",confirmButtonText:"Ok"})})),$("#contact-form-section form").on("submit",(async function(e){e.preventDefault();const t={name:$('#contact-form-section input[name="name"]').val(),email:$('#contact-form-section input[name="email"]').val(),message:$('#contact-form-section textarea[name="message"]').val(),h826r2whj4fi_cjz8jxs2zuwahhhk6:""};if(!handleInvalidFormData(t,"contact"))return;Swal.fire({title:"Submitting form...",didOpen:()=>Swal.showLoading()});const n=await fetch("/includes/contact-send.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();Swal.fire({title:a.success?"Success":a.message,text:a.success?"Your message has been sent successfully.":"error",icon:a.success?"Success":"Error"})}))}));